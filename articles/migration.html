<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>{shinytest} migration guide • shinytest2</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="{shinytest} migration guide">
<meta property="og:description" content="shinytest2">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">shinytest2</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/migration.html">{shinytest} migration guide</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/rstudio/shinytest2/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="migration_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>{shinytest} migration guide</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/rstudio/shinytest2/blob/HEAD/vignettes/migration.Rmd" class="external-link"><code>vignettes/migration.Rmd</code></a></small>
      <div class="hidden name"><code>migration.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rstudio/shinytest2" class="external-link">shinytest2</a></span><span class="op">)</span>
<span class="co">#&gt; Loading required package: testthat</span></code></pre></div>
<div class="section level2">
<h2 id="shinytest-migration-guide">
<code>{shinytest}</code> Migration Guide<a class="anchor" aria-label="anchor" href="#shinytest-migration-guide"></a>
</h2>
</div>
<div class="section level2">
<h2 id="code">Code<a class="anchor" aria-label="anchor" href="#code"></a>
</h2>
<p>This section is a comprehensive guide to migrate your <a href="https://github.com/rstudio/shinytest" class="external-link">shinytest</a> testing code to the new <a href="https://github.com/rstudio/shinytest2" class="external-link">shinytest2</a> testing code.</p>
<div class="section level3">
<h3 id="methods">Methods<a class="anchor" aria-label="anchor" href="#methods"></a>
</h3>
<ul>
<li>
<code>old$click(name, iotype = c("auto", "input", "output"))</code>: The parameters have been separated out to be clearer in their intended use: <code>new$click(input, output, ..., selector)</code>.</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Old</span>
<span class="va">old</span><span class="op">$</span><span class="fu">click</span><span class="op">(</span><span class="st">"mybutton"</span><span class="op">)</span>
<span class="va">old</span><span class="op">$</span><span class="fu">click</span><span class="op">(</span><span class="st">"clickcount"</span>, iotype <span class="op">=</span> <span class="st">"output"</span><span class="op">)</span>
<span class="va">old</span><span class="op">$</span><span class="fu">click</span><span class="op">(</span><span class="st">"my_id"</span>, iotype <span class="op">=</span> <span class="st">"auto"</span><span class="op">)</span>

<span class="co">## New</span>
<span class="va">new</span><span class="op">$</span><span class="fu">click</span><span class="op">(</span><span class="st">"mybutton"</span><span class="op">)</span>; <span class="va">new</span><span class="op">$</span><span class="fu">click</span><span class="op">(</span>input <span class="op">=</span> <span class="st">"mybutton"</span><span class="op">)</span>
<span class="va">new</span><span class="op">$</span><span class="fu">click</span><span class="op">(</span>output <span class="op">=</span> <span class="st">"clickcount"</span><span class="op">)</span>
<span class="va">new</span><span class="op">$</span><span class="fu">click</span><span class="op">(</span>selector <span class="op">=</span> <span class="st">"#my_id"</span><span class="op">)</span></code></pre></div>
<ul>
<li>
<code>old$executeScript(script, ...)</code>: The <code>...</code> must now be supplied to <code>arguments</code>. This allows for extra parameters such as <code>file</code> which can contain your <code>script</code> content or <code>timeout</code> which will throw an error if the <code>timeout</code> (in milliseconds) is reached before the script returns. Note, all <code>script</code>s now require a <code>return</code> statement and are executed within a function to be able to access <code>arguments</code>. If a promise is returned from the <code>script</code> then the <code>resolve</code>d value will be sent back to the R session.</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Old</span>
<span class="va">old</span><span class="op">$</span><span class="fu">executeScript</span><span class="op">(</span><span class="st">"1 + 1;"</span><span class="op">)</span>
<span class="va">old</span><span class="op">$</span><span class="fu">executeScript</span><span class="op">(</span><span class="st">"var life = arguments[0]; life;"</span>, <span class="fl">42</span><span class="op">)</span>

<span class="co">## New</span>
<span class="va">new</span><span class="op">$</span><span class="fu">execute_js</span><span class="op">(</span><span class="st">"return 1 + 1;"</span><span class="op">)</span>
<span class="va">new</span><span class="op">$</span><span class="fu">execute_js</span><span class="op">(</span><span class="st">"let life = arguments[0]; return life;"</span>, arguments <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span><span class="op">)</span>
<span class="co"># If a promise is returned, the resolved value will be sent back to the R session</span>
<span class="va">new</span><span class="op">$</span><span class="fu">execute_js</span><span class="op">(</span>
  <span class="st">"
  let life = arguments[0];
  return new Promise((resolve, reject) =&gt; resolve(life));
  "</span>,
  arguments <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<ul>
<li>
<code>old$executeScriptAsync(script, ...)</code>: This method magically added a <code>callback</code> argument and would block the R session until <code>callback</code> was called within <code>script</code>. In <code>shinytest2</code>, your script will need to be updated to use a JavaScript Promise. The Promise’s <code>resolve</code> method should be your callback that you used previously. You should also provide a maximum <code>timeout</code> (in milliseconds) that you are willing to wait before an error is thrown. Ex:</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Old</span>
<span class="co"># Wait until a button is clicked</span>
<span class="va">old</span><span class="op">$</span><span class="fu">executeScriptAsync</span><span class="op">(</span>
  <span class="st">'
  var selector = arguments[0];
  var callback = arguments[1];
  $( selector ).one( "click", function() {
    callback();
  });
  '</span>,
  <span class="st">"#mybutton"</span>
<span class="op">)</span>

<span class="co"># New</span>
<span class="co"># Wait until a button is clicked</span>
<span class="va">new</span><span class="op">$</span><span class="fu">execute_js</span><span class="op">(</span>
  <span class="st">'
  let selector = arguments[0];
  return new Promise((resolve, reject) =&gt; {
    $( selector ).one( "click", function() {
      resolve();
    });
  });
  '</span>,
  arguments <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"#mybutton"</span><span class="op">)</span>,
  timeout <span class="op">=</span> <span class="fl">15</span> <span class="op">*</span> <span class="fl">1000</span>
<span class="op">)</span></code></pre></div>
<ul>
<li>
<code>old$getAllValues(input = TRUE, output = TRUE, export = TRUE)</code>: This method has been renamed to <code>new$get_values(input, output, export)</code>. The new method has a slightly different behavior if a some of the <code>input</code>, <code>output</code> or <code>export</code> are provided. If <code>input</code>, <code>output</code> or <code>export</code> are provided, then the method will return the values for the provided <code>input</code>, <code>output</code> or <code>export</code> only. If no <code>input</code>, <code>output</code> or <code>export</code> are provided, then the method will return all values, similar to setting <code>input = TRUE, output = TRUE, export = TRUE</code>.</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Old</span>
<span class="va">old</span><span class="op">$</span><span class="fu">getAllValues</span><span class="op">(</span><span class="op">)</span>
<span class="co"># All input values</span>
<span class="va">old</span><span class="op">$</span><span class="fu">getAllValues</span><span class="op">(</span>input <span class="op">=</span> <span class="cn">TRUE</span>, output <span class="op">=</span> <span class="cn">FALSE</span>, export <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="co"># Only `clickcount` output value</span>
<span class="va">old</span><span class="op">$</span><span class="fu">getAllValues</span><span class="op">(</span>input <span class="op">=</span> <span class="cn">FALSE</span>, output <span class="op">=</span> <span class="st">"clickcount"</span>, export <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="co">## New</span>
<span class="va">new</span><span class="op">$</span><span class="fu">get_values</span><span class="op">(</span><span class="op">)</span>
<span class="co"># All input values</span>
<span class="va">new</span><span class="op">$</span><span class="fu">get_values</span><span class="op">(</span>input <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co"># Only `clickcount` output value</span>
<span class="va">new</span><span class="op">$</span><span class="fu">get_values</span><span class="op">(</span>output <span class="op">=</span> <span class="st">"clickcount"</span><span class="op">)</span></code></pre></div>
<ul>
<li>
<code>old$getUrl()</code>: This method has been renamed to <code>new$get_url()</code>.</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Old</span>
<span class="va">old</span><span class="op">$</span><span class="fu">getUrl</span><span class="op">(</span><span class="op">)</span>

<span class="co">## New</span>
<span class="va">new</span><span class="op">$</span><span class="fu">get_url</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<ul>
<li>
<code>old$setInputs(..., wait_ = TRUE, values_ = TRUE, timeout_ = 3 * 1000, allowInputNoBinding_ = FALSE, priority_ = c("input", "event"))</code>: The method name has been renamed and the parameters have been <code>snake_case</code>’ed. <code>value_</code> has been removed, but the same functionality can be achieved via a call to <code>new$get_values()</code> afterwards.</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Old</span>
<span class="va">getValuesResult</span> <span class="op">&lt;-</span> <span class="va">old</span><span class="op">$</span><span class="fu">setInputs</span><span class="op">(</span>life <span class="op">=</span> <span class="fl">42</span><span class="op">)</span>

<span class="co">## New</span>
<span class="va">new</span><span class="op">$</span><span class="fu">set_inputs</span><span class="op">(</span>life <span class="op">=</span> <span class="fl">42</span><span class="op">)</span>
<span class="va">get_values_result</span> <span class="op">&lt;-</span> <span class="va">new</span><span class="op">$</span><span class="fu">get_values</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<ul>
<li>
<code>old$getWindowSize()</code>, <code>old$setWindowSize(width, height)</code>: These methods have bee renamed to <code>new$get_window_size()</code> and <code>new$set_window_size(width, height)</code>.</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Old</span>
<span class="va">old</span><span class="op">$</span><span class="fu">getWindowSize</span><span class="op">(</span><span class="op">)</span>
<span class="va">old</span><span class="op">$</span><span class="fu">setWindowSize</span><span class="op">(</span>width <span class="op">=</span> <span class="fl">1024</span>, height <span class="op">=</span> <span class="fl">768</span><span class="op">)</span>

<span class="co">## New</span>
<span class="va">new</span><span class="op">$</span><span class="fu">get_window_size</span><span class="op">(</span><span class="op">)</span>
<span class="va">new</span><span class="op">$</span><span class="fu">set_window_size</span><span class="op">(</span>width <span class="op">=</span> <span class="fl">1024</span>, height <span class="op">=</span> <span class="fl">768</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="snapshots">Snapshots<a class="anchor" aria-label="anchor" href="#snapshots"></a>
</h3>
<p>Snapshots are now handled by <a href="https://testthat.r-lib.org" class="external-link">testthat</a>. To leverage this, use the <code>new$expect_*()</code> methods to assert the value is consistent over many testing executions given the variant supplied at initialization.</p>
<ul>
<li>
<code>old$snapshotInit(path, screenshot)</code>: This method has been moved to the parameters: <code>AppDriver$new(name = path)</code>. By default, <code>name</code> is set to the Shiny application’s directory name. Screenshots that may be tested are not allowed until some <code>AppDriver$new(variant=)</code> value is provided, similar to <code>suffix</code> value in <code>ShinyDriver$new(suffix=)</code>.</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Old</span>
<span class="va">old</span><span class="op">$</span><span class="fu">snapshotInit</span><span class="op">(</span><span class="st">"mytest"</span><span class="op">)</span>

<span class="co">## New</span>
<span class="va">new</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/AppDriver.html">AppDriver</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"mytest"</span>, variant <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>
<span class="co"># Suggested</span>
<span class="va">new</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/AppDriver.html">AppDriver</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"mytest"</span>, variant <span class="op">=</span> <span class="fu"><a href="../reference/platform_variant.html">platform_variant</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<ul>
<li>
<code>old$snapshot(items, filename, screenshot)</code>: This method would take both expect a screenshot and expect all values to be consistent. This method no longer exists in <a href="https://github.com/rstudio/shinytest2" class="external-link">shinytest2</a> and has been broken up into two explicitly called methods: <code>new$expect_screenshot()</code> and <code>new$expect_values()</code>. <code>new$expect_values()</code> will (by default) take a <em>debug</em> screenshot that will never fail in an expectation. This allows for a historical record (version control) of what the app looked like while not having to constantly battle with false-positive screenshot failures. If an single <code>output</code> value is supplied to <code>new$expect_values()</code>, then the <em>debug</em> screenshot is zoomed in on the output value.</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Old</span>
<span class="va">old</span><span class="op">$</span><span class="fu">snapshot</span><span class="op">(</span><span class="op">)</span>
<span class="va">old</span><span class="op">$</span><span class="fu">snapshot</span><span class="op">(</span>items <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>output <span class="op">=</span> <span class="st">"clickcount"</span><span class="op">)</span><span class="op">)</span>

<span class="co">## New</span>
<span class="co"># Must supply `variant=` to be able to call `new$expect_screenshot()`</span>
<span class="va">new</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/AppDriver.html">AppDriver</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">path_to_app</span>, variant <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>
<span class="va">new</span><span class="op">$</span><span class="fu">expect_screenshot</span><span class="op">(</span><span class="op">)</span>; <span class="va">new</span><span class="op">$</span><span class="fu">expect_values</span><span class="op">(</span><span class="op">)</span>
<span class="va">new</span><span class="op">$</span><span class="fu">expect_screenshot</span><span class="op">(</span><span class="op">)</span>; <span class="va">new</span><span class="op">$</span><span class="fu">expect_values</span><span class="op">(</span>output <span class="op">=</span> <span class="st">"clickcount"</span><span class="op">)</span>

<span class="co"># Suggested;</span>
<span class="va">new</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/AppDriver.html">AppDriver</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">path_to_app</span><span class="op">)</span>
<span class="va">new</span><span class="op">$</span><span class="fu">expect_values</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<ul>
<li>
<code>old$takeScreenshot(file, id, parent)</code>: This method has been renamed to <code>new$screenshot(file)</code>, and the <code>id</code> and <code>parent</code> parameters have been removed. To use a selector, set <code>new$screenshot(myfile, selector = ".custom-selector")</code> or <code>screenshot_args</code> directly.</li>
</ul>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Old</span>
<span class="va">old</span><span class="op">$</span><span class="fu">takeScreenshot</span><span class="op">(</span><span class="st">"myfile1.png"</span><span class="op">)</span>
<span class="va">old</span><span class="op">$</span><span class="fu">takeScreenshot</span><span class="op">(</span><span class="st">"myfile2.png"</span>, id <span class="op">=</span> <span class="st">"myid"</span><span class="op">)</span>

<span class="co">## New</span>
<span class="va">new</span><span class="op">$</span><span class="fu">screenshot</span><span class="op">(</span><span class="st">"myfile1.png"</span><span class="op">)</span>
<span class="va">new</span><span class="op">$</span><span class="fu">screenshot</span><span class="op">(</span><span class="st">"myfile2.png"</span>, selector <span class="op">=</span> <span class="st">"#myid"</span><span class="op">)</span>
<span class="va">new</span><span class="op">$</span><span class="fu">screenshot</span><span class="op">(</span><span class="st">"myfile2.png"</span>, screenshot_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>selector <span class="op">=</span> <span class="st">"#myid"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<ul>
<li>
<code>old$snapshotDownload(id, filename)</code>: This method has been renamed to <code>new$expect_download(id, filename)</code>.</li>
</ul>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Old</span>
<span class="va">old</span><span class="op">$</span><span class="fu">snapshotDownload</span><span class="op">(</span><span class="st">"mylinkid"</span><span class="op">)</span>

<span class="co">## New</span>
<span class="va">new</span><span class="op">$</span><span class="fu">expect_download</span><span class="op">(</span><span class="st">"mylinkid"</span><span class="op">)</span></code></pre></div>
<ul>
<li><p><code>old$stop()</code>: Stayed the same! 🥳. In <a href="https://github.com/rstudio/shinytest2" class="external-link">shinytest2</a>, this will stop your chromote instance and clean up any temporary files.</p></li>
<li><p><code>old$uploadFile(..., wait_ = TRUE, timeout_ = 3 * 1000)</code>: This method has been renamed to <code>new$upload_file(...)</code> and the <code>values_</code> parameter has been removed.</p></li>
</ul>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Old</span>
<span class="va">old</span><span class="op">$</span><span class="fu">uploadFile</span><span class="op">(</span>myFileInput <span class="op">=</span> <span class="st">"myfile.txt"</span><span class="op">)</span>

<span class="co">## New</span>
<span class="va">new</span><span class="op">$</span><span class="fu">upload_file</span><span class="op">(</span>myFileInput <span class="op">=</span> <span class="st">"myfile.txt"</span><span class="op">)</span></code></pre></div>
<ul>
<li>
<code>old$waitFor(expr, checkInterval, timeout)</code>: This method has been renamed and had its parameters reordered to end up at <code>new$wait_for_js(script, timeout, interval)</code>. Like other JavaScript methods in <a href="https://github.com/rstudio/shinytest2" class="external-link">shinytest2</a>, <code>script</code> needs to explicity return a value.</li>
</ul>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Old</span>
<span class="va">old</span><span class="op">$</span><span class="fu">waitFor</span><span class="op">(</span><span class="st">"$('#myid').length &gt; 0"</span><span class="op">)</span>

<span class="co">## New</span>
<span class="va">new</span><span class="op">$</span><span class="fu">wait_for_js</span><span class="op">(</span><span class="st">"return $('#myid').length &gt; 0"</span><span class="op">)</span>;</code></pre></div>
<ul>
<li>
<code>old$waitForShiny()</code>: This method has been upgraded to <code>new$wait_for_idle(duration = 500, timeout = 30 * 1000)</code>. The <code>old$waitForShiny()</code> method only waited until a single snapshot in time stated that Shiny was no longer busy. The new method will wait until Shiny is “idle” for a set duration. It is useful to wait until Shiny has been idle for a set duration to avoid situations where dynamic UI needs to calculate new outputs given new input information. The old method might pre-emptively declare Shiny as idle, but the new method will wait until Shiny has stablized for the set duration.</li>
</ul>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Old</span>
<span class="va">old</span><span class="op">$</span><span class="fu">waitForShiny</span><span class="op">(</span><span class="op">)</span>

<span class="co">## New</span>
<span class="co"># Equivalent</span>
<span class="va">new</span><span class="op">$</span><span class="fu">wait_for_idle</span><span class="op">(</span>duration <span class="op">=</span> <span class="fl">0</span>, timeout <span class="op">=</span> <span class="fl">3</span> <span class="op">*</span> <span class="fl">1000</span><span class="op">)</span>
<span class="co"># Suggested (Shiny must become continuously idle for at least 500ms within 30s</span>
<span class="va">new</span><span class="op">$</span><span class="fu">wait_for_idle</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<ul>
<li>
<code>old$waitForValue(name, ignore, iotype, timeout, checkInterval)</code>: This (underutilized) method has had the <code>name</code>/<code>iotype</code> spread out into separate <code>input</code>, <code>output</code>, <code>export</code> parameters. Only one <code>input</code>/<code>output</code>/<code>export</code> value may be supplied in an <code>AppDriver</code> object. The <code>timeout</code> has been increased to 15 seconds. Both methods still poll the Shiny application at a set <code>interval</code> for the corresponding value to be something not in the <code>ignore</code> set of values.</li>
</ul>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Old</span>
<span class="va">old</span><span class="op">$</span><span class="fu">waitForValue</span><span class="op">(</span><span class="st">"myslider"</span><span class="op">)</span>
<span class="va">old</span><span class="op">$</span><span class="fu">waitForValue</span><span class="op">(</span><span class="st">"mydynamicplot"</span>, iotype <span class="op">=</span> <span class="st">"output"</span><span class="op">)</span>

<span class="co">## New</span>
<span class="va">new</span><span class="op">$</span><span class="fu">wait_for_value</span><span class="op">(</span><span class="st">"myslider"</span><span class="op">)</span>; <span class="va">new</span><span class="op">$</span><span class="fu">wait_for_value</span><span class="op">(</span>input <span class="op">=</span> <span class="st">"myslider"</span><span class="op">)</span>
<span class="va">new</span><span class="op">$</span><span class="fu">wait_for_value</span><span class="op">(</span>output <span class="op">=</span> <span class="st">"mydynamicplot"</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="elements-widgets">Elements / Widgets<a class="anchor" aria-label="anchor" href="#elements-widgets"></a>
</h3>
<p>Direct element or Widget support for <a href="https://github.com/rstudio/shinytest2" class="external-link">shinytest2</a> has been drastically reduced. With the ability to execute any JavaScript function via <code>$execute_js(script)</code>, it is now possible to reproduce many of the methods that were provided in <a href="https://github.com/rstudio/shinytest" class="external-link">shinytest</a>.</p>
<ul>
<li>
<code>old$findElement()</code>, <code>old$findElements()</code>, <code>old$findWidget()</code>: These methods have been removed. It is suggested to use JavaScript code directly or use newer helper methods.</li>
</ul>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Old</span>
<span class="va">old</span><span class="op">$</span><span class="fu">findElement</span><span class="op">(</span><span class="st">"#mybutton"</span><span class="op">)</span><span class="op">$</span><span class="fu">click</span><span class="op">(</span><span class="op">)</span>
<span class="va">old</span><span class="op">$</span><span class="fu">findElement</span><span class="op">(</span><span class="st">"#mybutton"</span><span class="op">)</span><span class="op">$</span><span class="fu">getText</span><span class="op">(</span><span class="op">)</span>
<span class="va">old</span><span class="op">$</span><span class="fu">findElement</span><span class="op">(</span><span class="st">"#mybutton"</span><span class="op">)</span><span class="op">$</span><span class="fu">getCssValue</span><span class="op">(</span><span class="st">"color"</span><span class="op">)</span>

<span class="co">## New</span>
<span class="va">new</span><span class="op">$</span><span class="fu">get_text</span><span class="op">(</span>selector <span class="op">=</span> <span class="st">"#mybutton"</span><span class="op">)</span>
<span class="va">new</span><span class="op">$</span><span class="fu">click</span><span class="op">(</span>selector <span class="op">=</span> <span class="st">"#mybutton"</span><span class="op">)</span>
<span class="co"># No direct equivalent method. Using JavaScript instead</span>
<span class="va">new</span><span class="op">$</span><span class="fu">execute_js</span><span class="op">(</span><span class="st">'$("#mybutton").css("color")'</span><span class="op">)</span></code></pre></div>
<ul>
<li>
<code>old$getSource()</code>, <code>old$getTitle()</code>: These methods can be achieved using JavaScript.</li>
</ul>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Old</span>
<span class="va">old</span><span class="op">$</span><span class="fu">getSource</span><span class="op">(</span><span class="op">)</span>
<span class="va">old</span><span class="op">$</span><span class="fu">getTitle</span><span class="op">(</span><span class="op">)</span>

<span class="co"># New</span>
<span class="va">new</span><span class="op">$</span><span class="fu">get_html</span><span class="op">(</span><span class="st">"html"</span>, outer_html <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">new</span><span class="op">$</span><span class="fu">execute_js</span><span class="op">(</span><span class="st">"return window.document.title;"</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="testthat-method-updates">
<code>{testthat}</code> method updates<a class="anchor" aria-label="anchor" href="#testthat-method-updates"></a>
</h3>
<p><a href="https://github.com/rstudio/shinytest2" class="external-link">shinytest2</a> is heavily integrated with the <a href="https://testthat.r-lib.org" class="external-link">testthat</a> testing framework. Similar to <a href="https://github.com/rstudio/shinytest" class="external-link">shinytest</a>, snapshots are recorded but are recorded via <a href="https://testthat.r-lib.org" class="external-link">testthat</a>. For more information on the robustness of different testing approaches, please see the <a href="./testing-robustness.html">Testing Robustness</a> vignette.</p>
<ul>
<li>
<code>ShinyDriver$new(suffix=)</code>: Please use <code>AppDriver$new(variant=)</code>.</li>
</ul>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Old</span>
<span class="va">old</span> <span class="op">&lt;-</span> <span class="va">ShinyDriver</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">path_to_app</span>, suffix <span class="op">=</span> <span class="st">"macos-4.1"</span><span class="op">)</span>

<span class="co">## New</span>
<span class="va">new</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/AppDriver.html">AppDriver</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">path_to_app</span>, variant <span class="op">=</span> <span class="st">"macos-4.1"</span><span class="op">)</span></code></pre></div>
<ul>
<li>
<code>new$expect_screenshot()</code>, <code>new$screenshot(TODO)</code>: This method is a wrapper around <code><a href="https://testthat.r-lib.org/reference/expect_snapshot_file.html" class="external-link">testthat::expect_snapshot_file()</a></code> with <code>variant = new$get_variant()</code>. This method has been separated from <code>old$snapshot()</code> and is not explicitly called.</li>
</ul>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## New</span>
<span class="va">new</span><span class="op">$</span><span class="fu">expect_screenshot</span><span class="op">(</span><span class="op">)</span>
<span class="va">new</span><span class="op">$</span><span class="fu">screenshot</span><span class="op">(</span><span class="st">"myscreenshot.png"</span><span class="op">)</span></code></pre></div>
<ul>
<li><p><code>new$expect_values(TODO)</code>, <code>new$get_values(TODO)</code></p></li>
<li><p><code>new$expect_text(TODO)</code>, <code>new$get_text(TODO)</code></p></li>
<li><p><code>new$expect_html(TODO)</code>, <code>new$get_html(TODO)</code></p></li>
<li><p><code>old$getRelativePathToApp()</code>, <code>old$getTestsDir()</code>: These methods have been removed as they are no longer needed given execution <a href="https://github.com/rstudio/shinytest2" class="external-link">shinytest2</a> testing is always done within the <a href="https://testthat.r-lib.org" class="external-link">testthat</a> testing framework.</p></li>
<li><p><code>old$getSnapshotDir()</code>: This method has been removed as <a href="https://testthat.r-lib.org" class="external-link">testthat</a> uses the <code>./_snaps</code> directory to store snapshot outputs.</p></li>
<li><p><code>old$expectUpdate(output)</code>: This method is no longer supported. While knowing that an output value has been updated, it is very uncertain as to what the new value is. While possibly useful, it is not robust. Other testing methods should be explored. Equivalent code has been provided below.</p></li>
</ul>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Old</span>
<span class="va">old</span><span class="op">$</span><span class="fu">expectUpdate</span><span class="op">(</span><span class="st">"myoutput"</span>, myinput <span class="op">=</span> <span class="fl">42</span><span class="op">)</span>

<span class="co">## New (equivalent code)</span>
<span class="va">myoutput_prior</span> <span class="op">&lt;-</span> <span class="va">new</span><span class="op">$</span><span class="fu">get_values</span><span class="op">(</span>output <span class="op">=</span> <span class="st">"myoutput"</span><span class="op">)</span>
<span class="va">new</span><span class="op">$</span><span class="fu">set_inputs</span><span class="op">(</span>myinput <span class="op">=</span> <span class="fl">42</span><span class="op">)</span>
<span class="fu">testthat</span><span class="fu">::</span><span class="fu"><a href="https://testthat.r-lib.org/reference/expect_success.html" class="external-link">expect_failure</a></span><span class="op">(</span>
  <span class="fu">testthat</span><span class="fu">::</span><span class="fu"><a href="https://testthat.r-lib.org/reference/equality-expectations.html" class="external-link">expect_equal</a></span><span class="op">(</span>
    <span class="va">new</span><span class="op">$</span><span class="fu">get_values</span><span class="op">(</span>output <span class="op">=</span> <span class="st">"myoutput"</span><span class="op">)</span>,
    <span class="va">myoutput_prior</span>
  <span class="op">)</span>
<span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="debugging">Debugging<a class="anchor" aria-label="anchor" href="#debugging"></a>
</h3>
<p>Debugging in <a href="https://github.com/rstudio/shinytest2" class="external-link">shinytest2</a> has been unified and enabled at all times. The <a href="https://github.com/rstudio/shinytest" class="external-link">shinytest</a> debugging methods have been removed in favor of <code>new$get_log()</code> which returns a similarly shaped <code>tibble</code> as <code>old$getDebugLog()</code>’s <code>data.frame</code>. The columns have been altered to be more generic where <code>type</code> has been broken into two columns: <code>location</code> and <code>level</code>.</p>
<ul>
<li>
<code>old$getDebugLog()</code>, <code>old$getEventLog()</code>: Now use <code>new$get_log()</code>.</li>
<li>
<code>old$enableDebugLogMessages(enable = TRUE)</code>: No longer used. <em>All</em> messages are now recorded.</li>
<li>
<code>old$logEvent(event, ...)</code>: Messages can still be recorded using <code>new$log_message(text)</code>, but <code>...</code> values are no longer supported.</li>
</ul>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Old</span>
<span class="va">old</span><span class="op">$</span><span class="fu">getDebugLog</span><span class="op">(</span><span class="op">)</span>; <span class="va">old</span><span class="op">$</span><span class="fu">getEventLog</span><span class="op">(</span><span class="op">)</span>
<span class="va">old</span><span class="op">$</span><span class="fu">logEvent</span><span class="op">(</span><span class="st">"Creating report"</span><span class="op">)</span>

<span class="co">## New</span>
<span class="va">new</span><span class="op">$</span><span class="fu">get_log</span><span class="op">(</span><span class="op">)</span>
<span class="va">old</span><span class="op">$</span><span class="fu">log_message</span><span class="op">(</span><span class="st">"Creating report"</span><span class="op">)</span></code></pre></div>
<p>If <code>options = list(shiny.trace = TRUE)</code> is set when initializing a <code>AppDriver</code> object, then all WebSocket traffic will be recorded.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## New</span>
<span class="co"># Record all websocket traffic. Very verbose!</span>
<span class="va">new</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/AppDriver.html">AppDriver</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">path_to_app</span>, options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>shiny.trace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>
<span class="va">new</span><span class="op">$</span><span class="fu">get_log</span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="other-removed-methods">Other removed methods<a class="anchor" aria-label="anchor" href="#other-removed-methods"></a>
</h3>
<ul>
<li>
<code>old$getValue(name, iotype)</code> and <code>old$setValue(name, value, iotype)</code>: These methods have been removed as they were not generic and similar behavior achieved via <code>new$get_values(input = name)[["input"]][[name]]</code> and <code>new$set_inputs(name = value)</code>.</li>
</ul>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Old</span>
<span class="va">old</span><span class="op">$</span><span class="fu">getValue</span><span class="op">(</span><span class="st">"myinput"</span><span class="op">)</span>
<span class="va">old</span><span class="op">$</span><span class="fu">setValue</span><span class="op">(</span><span class="st">"myinput"</span>, <span class="fl">42</span><span class="op">)</span>

<span class="co">## New</span>
<span class="va">new</span><span class="op">$</span><span class="fu">get_values</span><span class="op">(</span>input <span class="op">=</span> <span class="st">"myinput"</span><span class="op">)</span><span class="op">[[</span><span class="st">"input"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"myinput"</span><span class="op">]</span><span class="op">]</span>
<span class="va">new</span><span class="op">$</span><span class="fu">set_inputs</span><span class="op">(</span>myinput <span class="op">=</span> <span class="fl">42</span><span class="op">)</span></code></pre></div>
<ul>
<li>
<code>old$listWidgets()</code>: This method has been removed and can be achieved by getting the names of the existing values: <code>new$get_values()</code>.</li>
</ul>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Old</span>
<span class="va">old</span><span class="op">$</span><span class="fu">listWidgets</span><span class="op">(</span><span class="op">)</span>

<span class="co">## New</span>
<span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">new</span><span class="op">$</span><span class="fu">get_values</span><span class="op">(</span><span class="op">)</span>, <span class="va">names</span><span class="op">)</span></code></pre></div>
<ul>
<li><p><code>old$checkUniqueWidgetNames()</code>: Automatically performed on startup in <a href="https://github.com/rstudio/shinytest2" class="external-link">shinytest2</a>. TODO-barret; <code>AppDriver$expect_unique_names()</code></p></li>
<li><p><code>old$clone()</code>: <code>AppDriver</code> does not support cloning. (The underlying <code>ChromoteSession</code> does not support cloning, so <code>AppDriver</code> can not support cloning.)</p></li>
<li><p><code>old$goBack()</code>, <code>old$refresh()</code>: These method have been removed and can be achieved with <code>new$execute_js(script)</code>.</p></li>
</ul>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Old</span>
<span class="va">old</span><span class="op">$</span><span class="fu">goBack</span><span class="op">(</span><span class="op">)</span>
<span class="va">old</span><span class="op">$</span><span class="fu">refresh</span><span class="op">(</span><span class="op">)</span>

<span class="co">## New</span>
<span class="co"># Go back</span>
<span class="va">new</span><span class="op">$</span><span class="fu">execute_js</span><span class="op">(</span><span class="st">"window.history.back();"</span><span class="op">)</span>
<span class="co"># Refresh page</span>
<span class="va">new</span><span class="op">$</span><span class="fu">execute_js</span><span class="op">(</span><span class="st">"window.location.reload();"</span><span class="op">)</span></code></pre></div>
<ul>
<li>
<code>old$getAppDir()</code>, <code>old$getAppFilename()</code>, <code>old$isRmd()</code>: These methods have been removed in favor of <code>new$get_path()</code>. All of the same information can be accessed via <code>new$get_path()</code>.</li>
</ul>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Old</span>
<span class="va">old</span><span class="op">$</span><span class="fu">isRmd</span><span class="op">(</span><span class="op">)</span>
<span class="va">old</span><span class="op">$</span><span class="fu">getAppDir</span><span class="op">(</span><span class="op">)</span>
<span class="va">old</span><span class="op">$</span><span class="fu">getAppFilename</span><span class="op">(</span><span class="op">)</span>

<span class="co">## New</span>
<span class="va">path</span> <span class="op">&lt;-</span> <span class="va">new</span><span class="op">$</span><span class="fu">get_path</span><span class="op">(</span><span class="op">)</span>
<span class="va">is_rmd</span> <span class="op">&lt;-</span> <span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/path_file.html" class="external-link">path_ext</a></span><span class="op">(</span><span class="va">path</span><span class="op">)</span> <span class="op">==</span> <span class="st">".Rmd"</span>
<span class="va">app_dir</span> <span class="op">&lt;-</span> <span class="kw">if</span> <span class="op">(</span><span class="va">is_rmd</span><span class="op">)</span> <span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/path_file.html" class="external-link">path_dir</a></span><span class="op">(</span><span class="va">path</span><span class="op">)</span> <span class="kw">else</span> <span class="va">path</span>
<span class="va">filename</span> <span class="op">&lt;-</span> <span class="kw">if</span> <span class="op">(</span><span class="va">is_rmd</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">basename</a></span><span class="op">(</span><span class="va">path</span><span class="op">)</span> <span class="kw">else</span> <span class="cn">NULL</span></code></pre></div>
<ul>
<li>
<code>old$sendKeys(name, keys)</code>: This method has been removed and there is currently no easy alternative. If you are familiar with the <a href="https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/keyCode#value_of_keycode" class="external-link">key code values</a>, you can trigger then with <code>new$execute_js(script)</code>.</li>
</ul>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Old</span>
<span class="va">old</span><span class="op">$</span><span class="fu">sendKeys</span><span class="op">(</span><span class="st">"myinput"</span>, <span class="fu">webdriver</span><span class="fu">::</span><span class="va">keys</span><span class="op">$</span><span class="va">enter</span><span class="op">)</span>

<span class="co">## New</span>
<span class="va">new</span><span class="op">$</span><span class="fu">execute_js</span><span class="op">(</span><span class="st">"$('#myinput').trigger({type: 'keypress', which: 13, keyCode: 13});"</span><span class="op">)</span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Barret Schloerke, RStudio.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
