<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Documentation: • shinytest2</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css"><script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet"><script src="pkgdown.js"></script><meta property="og:title" content="Documentation:"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-title-body">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">shinytest2</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="reference/index.html">Reference</a>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/rstudio/shinytest2/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
    <div class="page-header">
      <h1>Documentation:</h1>
    </div>


<p>make vignette of steps make an automatic conversion function? keep if &gt;90% success</p>
<p>talk to lionel about snapshots</p>
<p>issue in testthat for keeping snapshots if they are not touched <a href="https://github.com/r-lib/testthat/issues/1143" class="external-link uri">https://github.com/r-lib/testthat/issues/1143</a></p>
<p>automate platform / R version suffix</p>
<p>gha upload an artifact with updated snapshots like fix_all_branches, it must be initiated manually, but <em>automated</em></p>
<p><a href="https://github.com/r-lib/vdiffr/blob/fc03e91cccac04baa875063513b630d80c02e197/R/expect-doppelganger.R#L99-L102" class="external-link uri">https://github.com/r-lib/vdiffr/blob/fc03e91cccac04baa875063513b630d80c02e197/R/expect-doppelganger.R#L99-L102</a> # Announce snapshot file before touching <code>fig</code> in case evaluation # causes an error. This allows testthat to restore the files # (see r-lib/testthat#1393). testthat::announce_snapshot_file(name = file)</p>
<p>handle failures: <a href="https://github.com/r-lib/vdiffr/blob/fc03e91cccac04baa875063513b630d80c02e197/R/expect-doppelganger.R#L127-L151" class="external-link uri">https://github.com/r-lib/vdiffr/blob/fc03e91cccac04baa875063513b630d80c02e197/R/expect-doppelganger.R#L127-L151</a> push_log stores information to a log file that is visible by cran and the testthat fail output logs</p>
<p>provide custom function to compare the files: <a href="https://github.com/r-lib/vdiffr/blob/fc03e91cccac04baa875063513b630d80c02e197/R/expect-doppelganger.R#L132" class="external-link uri">https://github.com/r-lib/vdiffr/blob/fc03e91cccac04baa875063513b630d80c02e197/R/expect-doppelganger.R#L132</a></p>
<p>use the annouce_snapshot_file w/ the <code>suffix</code> so that they other files are not deleted. Do not announce the main file?</p>
<p>Make two classes of shinytest objects: * One for shinytest2 legacy that throws deprecation messages and errors. * ShinyDriver2Legacy<span class="math inline"><em>n</em><em>e</em><em>w</em>()? * <em>A</em><em>n</em><em>o</em><em>t</em><em>h</em><em>e</em><em>r</em><em>t</em><em>h</em><em>a</em><em>t</em><em>i</em><em>s</em><em>t</em><em>h</em><em>e</em><em>i</em><em>d</em><em>e</em><em>a</em><em>l</em><em>s</em><em>h</em><em>i</em><em>n</em><em>y</em><em>t</em><em>e</em><em>s</em><em>t</em>2<em>o</em><em>b</em><em>j</em><em>e</em><em>c</em><em>t</em>.<em>T</em><em>h</em><em>i</em><em>s</em><em>s</em><em>h</em><em>o</em><em>u</em><em>l</em><em>d</em><em>n</em><em>o</em><em>t</em><em>c</em><em>o</em><em>n</em><em>t</em><em>a</em><em>i</em><em>n</em><em>d</em><em>e</em><em>p</em><em>r</em><em>e</em><em>c</em><em>a</em><em>t</em><em>e</em><em>d</em><em>m</em><em>e</em><em>t</em><em>h</em><em>o</em><em>d</em><em>s</em> * <em>S</em><em>h</em><em>i</em><em>n</em><em>y</em><em>D</em><em>r</em><em>i</em><em>v</em><em>e</em><em>r</em>2</span>new() ? * Shintest2$new() ?</p>
<p>Alpha order input values when serializing to json</p>
<p>conversion notes shinytest -&gt; shinytest2 phantomTimeout -&gt; X</p>
<p><code>$findElement()</code> does not support <code>linkText</code>, <code>partialLinkText</code>, <code>xpath</code></p>
<p><!-- $executeScript -> $executeScript --> $executeScriptAsync -&gt; $executeScriptCallback</p>
<p><code>Widget$new(element=)</code> -&gt; <code>Widget2$new(nodeId=)</code></p>
<p>app$snapshot(<em>) -&gt; expect_shinytest2_snapshot(app, </em>)</p>
<p>make a second class for ShinyDriver2Legacy ShinyDriver2<span class="math inline">$initalize() Added `...`  ShinyDriver2Legacy$</span>snapshotInit(path=) does not makes sense ShinyDriver2Legacy<span class="math inline"><em>s</em><em>n</em><em>a</em><em>p</em><em>s</em><em>h</em><em>o</em><em>t</em><em>I</em><em>n</em><em>i</em><em>t</em>(<em>s</em><em>c</em><em>r</em><em>e</em><em>e</em><em>n</em><em>s</em><em>h</em><em>o</em><em>t</em> = )<em>w</em><em>a</em><em>s</em><em>m</em><em>o</em><em>v</em><em>e</em><em>d</em><em>t</em><em>o</em><em>S</em><em>h</em><em>i</em><em>n</em><em>y</em><em>D</em><em>r</em><em>i</em><em>v</em><em>e</em><em>r</em>2</span>initialize(screenshot=)</p>
<p>ShinyDriver2$waitFor returns <code>FALSE</code> if a condition is not found in time. (Not <code>NA</code>) execut</p>
<p>#’ @seealso [testthat::snapshot_review()] and [testthat::snapshot_accept()] if #’ you want to compare or update snapshots after testing. In most cases, the #’ user is prompted to do these tasks interactively, but there are also times #’ where it is useful to call these functions from the console.</p>
<p>√ ShinyDriver<span class="math inline"><em>s</em><em>e</em><em>l</em><em>f</em></span>waitForShiny -&gt; ShinyDriver2<span class="math inline"><em>w</em><em>a</em><em>i</em><em>t</em><sub><em>f</em></sub><em>o</em><em>r</em><sub><em>i</em></sub><em>d</em><em>l</em><em>e</em><em>S</em><em>h</em><em>i</em><em>n</em><em>y</em><em>D</em><em>r</em><em>i</em><em>v</em><em>e</em><em>r</em></span>self$findWidget -&gt; gone</p>
<ul><li><p>move all documentation back to within AppDriver</p></li>
<li><p>rename shinydriver to AppDriver</p></li>
<li><p>make test_app()</p></li>
<li><p>remove all external methods such as <code>app_METHOD()</code> that are wrappers to <code>app$METHOD()</code></p></li>
</ul><p>list_widgets -&gt; get_input_names, get_output_names … -&gt; arguments get_all_values -&gt; get_values</p>
<p>get_all_values(input, output, export) -&gt; get_values(input, output, export) why not <code>get_input_values()</code>? What about <code>get_names()</code> list widgets is a JS method that looks for shiny classes, why not use <code>get_values()</code> and</p>
<p>Implement get_names() -&gt; this should give all <code>input</code>, <code>output</code>, and <code>export</code> names via <code>get_values()</code></p>
<p>Requirements for release: * √ Fix recorder * √ unknown fn * √ path - remove * √ test file name: test-NAME.R * √ spacing after library call * Expectations: * Have all expect methods return the <code>x</code> value used in the <code>expect_equal(x, y)</code> * Add <code>expect_values(input = missing_arg(), output = missing_arg(), export = missing_arg(), ..., cran = TRUE)</code>, and maybe <code>expect_input()</code>, <code>expect_output()</code>, <code>expect_export()</code> * Add <code>expect_screenshot()</code> * make <code>variant</code> a <code>missing_arg()</code> and have it throw on <code>expect_screenshot()</code> if not supplied. * Remove <code>expect_appshot()</code> * shinytest -&gt; shinytest2 conversion file * cover the good bits, throw on more custom bits * readme * website * vignettes Future release: * GHA integration</p>
<div id="documentation" class="section level1">

<div class="section level3">
<h3 id="vignettes">Vignettes:<a class="anchor" aria-label="anchor" href="#vignettes"></a></h3>
<ul><li>Which do I need and why do I need them?</li>
<li>Explain testing robustness
<ul><li>Robust to flakey; Sensitivity to external updates <!-- * `$expect_names(key)` - TODO- add this method; save outputs to snapshots if no key is provided
    * `$expect_appshot(items = value, screenshot = FALSE)` -->
<ul><li>
<code>$expect_values(input, output, export)</code> - TODO- add this method; save outputs to snapshots
<ul><li><code>$expect_appshot(items = value, screenshot = FALSE)</code></li>
</ul></li>
<li>
<code>$expect_text()</code>
<ul><li>Text wont really change</li>
</ul></li>
<li>
<code>$expect_html()</code>
<ul><li>Classes could be added by external packages</li>
</ul></li>
<li>
<code>$expect_appshot()</code>
<ul><li>images are not reliable</li>
</ul></li>
</ul></li>
</ul></li>
</ul></div>
<div class="section level3">
<h3 id="docs">Docs:<a class="anchor" aria-label="anchor" href="#docs"></a></h3>
<ul><li>What are the conditions that I need this function?</li>
<li>Priority sort the App docs methods
<ul><li>Tell docs that they are sorted for a reason</li>
</ul></li>
<li>Add some description about how often we guess people will use the method.
<ul><li>$execute_script_callback(): rare; Only if your JS requires a callback; Otherwise use $execute_script()</li>
</ul></li>
<li>Migration guide from shinytest -&gt; shinytest2</li>
</ul></div>
<div class="section level3">
<h3 id="todo">TODO<a class="anchor" aria-label="anchor" href="#todo"></a></h3>
<ul><li>Drop <code>$get_names()</code>, <code>$get_values()</code>
</li>
<li>Rename <code>$wait_for_condition(expr=)</code> to <code>$wait_for_script(script=)</code>
</li>
<li>Remove <code>$wait_for_value()</code> in favor of <code>$wait_for_stable()</code>
</li>
</ul><p>execute_script_callback should not exist they can write a promise and await promise</p>
<p>add getter methods for all expectations add $get_variant()</p>
</div>
<div class="section level2">
<h2 id="todo-addd">TODO; addd<a class="anchor" aria-label="anchor" href="#todo-addd"></a></h2>
<p>app<span class="math inline">$expect_screenshot(selector) # assert screenshot equals app$</span>take_screenshot(selector) # screenshot helper file app$get_screenshot(selector, file) # save to file</p>
<p>app<span class="math inline">$expect_screenshot() # document that this is just equal to the next line expect_snapshot_file(app$</span>get_screenshot(), variant = app$get_variant(), compare = testthat::compare_file_binary)</p>
<p>app<span class="math inline"><em>e</em><em>x</em><em>p</em><em>e</em><em>c</em><em>t</em><sub><em>v</em></sub><em>a</em><em>l</em><em>u</em><em>e</em><em>s</em>()<em>e</em><em>x</em><em>p</em><em>e</em><em>c</em><em>t</em><sub><em>s</em></sub><em>n</em><em>a</em><em>p</em><em>s</em><em>h</em><em>o</em><em>t</em><sub><em>v</em></sub><em>a</em><em>l</em><em>u</em><em>e</em>(<em>a</em><em>p</em><em>p</em></span>get_values(), variant = app$get_variant(), compare = testthat::compare_file_text)</p>
<p>app &lt;- AppDriver$new(appDir)</p>
<p>app<span class="math inline">$click(id = "foo") app$</span>set_inputs(foo = “click”)</p>
<p>app<span class="math inline">$click(id = "foo") app$</span>click(id = “foo2”) app$set_inputs(foo = “click”, Z = “click”)</p>
<p>app<span class="math inline">$uploadFile(myFileInput = "filePath") app$</span>click(“Z”)</p>
<p>app$set_inputs(Z = “click”)</p>
<p>app$set_inputs(myFileInput = “filePath”, Z = “click”)</p>
<p>app$expect_snapshot() # <code>shinytest</code></p>
<p>app<span class="math inline"><em>e</em><em>x</em><em>p</em><em>e</em><em>c</em><em>t</em><sub><em>a</em></sub><em>p</em><em>p</em><em>s</em><em>h</em><em>o</em><em>t</em>()<em>a</em><em>p</em><em>p</em></span>take_screenshot(selector) # screenshot helper file app$expect_values()</p>
<p>app$expect_values() # json values</p>
<p>app<span class="math inline"><em>e</em><em>x</em><em>p</em><em>e</em><em>c</em><em>t</em><sub><em>s</em></sub><em>c</em><em>r</em><em>e</em><em>e</em><em>n</em><em>s</em><em>h</em><em>o</em><em>t</em>(<em>s</em><em>e</em><em>l</em><em>e</em><em>c</em><em>t</em><em>o</em><em>r</em>)<em>a</em><em>p</em><em>p</em></span>take_screenshot(selector) # screenshot value</p>
</div>
<div class="section level2">
<h2 id="todo-addd-1">TODO; addd<a class="anchor" aria-label="anchor" href="#todo-addd-1"></a></h2>
<p>app<span class="math inline">$expect_screenshot(selector) # assert screenshot equals app$</span>take_screenshot(selector) # screenshot helper file app$get_screenshot(selector, file) # save to file</p>
<p>app<span class="math inline">$expect_appshot(id = "winston")  app$</span>expect_values(auto = “winston”) app$expect_screenshot(selector = find_container(“winston”))</p>
<hr><ul><li>
<code>$expect_values()</code>
<ul><li>expects values only</li>
<li>
<code>$expect_values(screenshot = self$values_screenshot)</code>; <code>AppDriver$new(values_screenshot = getOption("shinytest2.values_screenshot", TRUE))</code>
</li>
<li>
<code>if (values_screenshot == TRUE)</code>
<ul><li>saves screenshot into <code>_snaps</code> folder and “annouce”s the file to avoid deletion
<ul><li>Should create a “new” image that diffviewer can view. But should NOT throw an error when the images are different</li>
<li>Creates too many commits for unnecessary changes
<ul><li>values-002-FLAG.png</li>
<li>.gitignore <code>-FLAG.png</code>
</li>
</ul></li>
<li>Allows for “logging” prior screenshot knowledge
<ul><li>NOT an expectation</li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
<li>$expect_screenshot()
<ul><li>expects screenshot only</li>
</ul></li>
</ul></div>
</div>
<div class="section level1">
<h1 id="todo-1">TODO<a class="anchor" aria-label="anchor" href="#todo-1"></a></h1>
<div class="section level2">
<h2 id="week-1">Week 1<a class="anchor" aria-label="anchor" href="#week-1"></a></h2>
<ul><li>Add <code>$get_values()</code>
<ul><li>And all other “get” methods</li>
</ul></li>
<li>wait_for_stable(duration = 500) -&gt; wait_for_idle(duration = 500)</li>
<li>Remove <code>wait_</code> from API</li>
<li>Transport chromote methods to {chromote}</li>
</ul></div>
<div class="section level2">
<h2 id="make-public-on-github">Make <em>public</em> on GitHub<a class="anchor" aria-label="anchor" href="#make-public-on-github"></a></h2>
<ul><li>Notify Eric and David</li>
</ul></div>
<div class="section level2">
<h2 id="week-2-pray">Week 2 (pray)<a class="anchor" aria-label="anchor" href="#week-2-pray"></a></h2>
<ul><li>Script for migrating from {shinytest} to {shinytest2}
<ul><li>AST
<ul><li>lose comments and formatting</li>
</ul></li>
<li>grep
<ul><li>harder in long run</li>
</ul></li>
<li>hybrid
<ul><li>Check out wch/staticdocs, r-lib/styler (or even r-lib/lintr)</li>
<li>maybe extract comments and reinsert after AST conversion</li>
</ul></li>
</ul></li>
</ul></div>
<div class="section level2">
<h2 id="week-3-4-document">Week 3-4 (document)<a class="anchor" aria-label="anchor" href="#week-3-4-document"></a></h2>
<div class="section level3">
<h3 id="vignettes-1">Vignettes:<a class="anchor" aria-label="anchor" href="#vignettes-1"></a></h3>
<ul><li>Which do I need and why do I need them?</li>
<li>Explain testing robustness
<ul><li>Robust to flakey; Sensitivity to external updates <!-- * `$expect_names(key)` - TODO- add this method; save outputs to snapshots if no key is provided
    * `$expect_appshot(items = value, screenshot = FALSE)` -->
<ul><li>
<code>$expect_values(input, output, export)</code> - TODO- add this method; save outputs to snapshots
<ul><li><code>$expect_appshot(items = value, screenshot = FALSE)</code></li>
</ul></li>
<li>
<code>$expect_text()</code>
<ul><li>Text wont really change</li>
</ul></li>
<li>
<code>$expect_html()</code>
<ul><li>Classes could be added by external packages</li>
</ul></li>
<li>
<code>$expect_appshot()</code>
<ul><li>images are not reliable</li>
</ul></li>
</ul></li>
</ul></li>
<li>Pull over vignettes from {shinytest} where appropriate</li>
</ul></div>
<div class="section level3">
<h3 id="docs-1">Docs:<a class="anchor" aria-label="anchor" href="#docs-1"></a></h3>
<ul><li>What are the conditions that I need this function?</li>
<li>Priority sort the App docs methods
<ul><li>Tell docs that they are sorted for a reason</li>
</ul></li>
<li>Add some description about how often we guess people will use the method.
<ul><li>$execute_script_callback(): rare; Only if your JS requires a callback; Otherwise use $execute_script()</li>
</ul></li>
<li>Migration guide from shinytest -&gt; shinytest2</li>
</ul></div>
</div>
<div class="section level2">
<h2 id="release">Release<a class="anchor" aria-label="anchor" href="#release"></a></h2>
</div>
</div>


  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>

</div>



      <footer><div class="copyright">
  <p></p><p>Developed by Barret Schloerke, RStudio.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

      </footer></div>

  


  

  </body></html>

